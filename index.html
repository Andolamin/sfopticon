<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="SfOpticon : In your Salesforce controlling your versions" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SfOpticon</title>
  </head>

  <body>
    <img src="/images/SfOpticon-icon-highres.png" style="position: absolute; left: 5px; top: 5px; height: 242px; width: 300px; border: 0px;" />

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/sfopticon/sfopticon">View on GitHub</a>

          <h1 id="project_title">SfOpticon</h1>
          <h2 id="project_tagline">In your Salesforce controlling your versions</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/sfopticon/sfopticon/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/sfopticon/sfopticon/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>SfOpticon is a tool to add software configuration management capabilities to the Salesforce development cycle. </p>

<h3>
<a name="getting-sfopticon" class="anchor" href="#getting-sfopticon"><span class="octicon octicon-link"></span></a>Getting SfOpticon</h3>

<p>The source for SfOpticon can be downloaded on this website as a zip archive or as a gzipped tarball. SfOpticon is in active development, and is still in Alpha status. If you would like to stay connected and ensure you always have the latest version it is recommended that you clone the git repository and follow us on Github.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> git clone https://github.com/sfopticon/sfopticon.git
</pre></div>

<p>Visit <a href="http://github.com/sfopticon/sfopticon">http://github.com/sfopticon/sfopticon</a> for the project page.</p>

<h3>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>Configuration details are stored in the 'application.yml' file. Please fill out your database and scm details here. Currently, MySQL and Github are the only supported configurations.</p>

<p>Note that the database section follows all configuration details of the ActiveRecord configuration.</p>

<h3>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h3>

<p>Please note that while the tools and libraries may install on a Windows system we have not tested this and do not support it at this time.</p>

<p>Installation is simple given a sane build environment. It requires <a href="https://www.ruby-lang.org/">ruby</a>, <a href="http://bundler.io/">bundler</a>, a configured database, and a GitHub account. </p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> <span class="nb">cd </span>sfopticon/
<span class="gp">$</span> bundle install
</pre></div>

<p>If installation fails verify that you have a sane build environment with all required development libraries for compiling native Ruby library extensions.</p>

<p>The most common cause for installation failure is compiling the extensions for <a href="http://nokogiri.org">Nokogiri</a> and MySQL. For Nokogiri you'll need to be sure you have libxml2-dev and libxslt-dev development libraries installed on your system. For MySQL make sure you have the client development libraries.</p>

<p>After the bundle install is successful, execute:</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> rake setup_db
</pre></div>

<h3>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h3>

<p>First, a production environment must be setup.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/environment.rb create --name &lt;YOUR_PROD_ENV_NAME&gt; --production
</pre></div>

<p>After you have created your production environment, feel free to create other non-production environments as you see fit.</p>

<p>To retrieve changes to your configured org you'll use the changeset subcommand of the scanner tool. You can do this manually, but it is recommended to create a relatively frequent (~20 - 30 minutes) cron job for this. As its name implies, the scanner tool scans your environment for changes and synchronizes them with the remote SCM system.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/scanner.rb changeset --org &lt;ENVIRONMENT_TO_SCAN&gt;
</pre></div>

<p>For sub-environments you'll want to rebase frequently. This brings changes down from the configured production environment and merges them into the sub-environment. Performing this step regularly will  reduce risk of merge conflicts.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/integrate.rb rebase --org &lt;ENVIRONMENT_TO_REBASE&gt;
</pre></div>

<p>Lastly, the integration tool allows you to integrate branches, and then deploy the merged changes to any environment.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/integrate.rb merge --source &lt;SOURCE_ENV&gt; --destination &lt;DEST_ENV&gt;
</pre></div>

<p>This will create an integration branch and perform a merge. If the merge is successful the changes will be deployed to the destination environment.</p>

<h2>
<a name="example-of-a-common-workflow" class="anchor" href="#example-of-a-common-workflow"><span class="octicon octicon-link"></span></a>Example of a Common Workflow</h2>

<p>The workflow we use (and what we expect to be a common workflow out in the wild) is a 
production environment with full sandboxes for feature development and hotfixes where the hotfix sandbox is kept in sync with production. The sandboxes are updated with any deploys to production for hotfix or separate feature releases.</p>

<p>Let's walk through using SfOpticon to manage this scenario.</p>

<p>First setup your environments. You must create your production environment first. You can specify --username and --password on the command line, or leave them out and allow the script to query you. Additionally, you can add --securitytoken.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/environment.rb create --name Prod --host login.salesforce.com --production
<span class="gp">$</span> ./bin/environment.rb create --name Hotfix --host test.salesforce.com
<span class="gp">$</span> ./bin/environment.rb create --name Sandbox1 --host test.salesforce.com
</pre></div>

<p>You now have an environment that looks like this
<img src="/images/Graph2.png" alt="Environment Graph"></p>

<h3>
<a name="change-monitoring" class="anchor" href="#change-monitoring"><span class="octicon octicon-link"></span></a>Change Monitoring</h3>

<p>You'll want to setup the changeset scanner to execute every 20 minutes or so. This is 
the piece that watches your Salesforce orgs, detects changes, and adds those changes 
to the underlying VCS.</p>

<p>Add a line to cron for each environment.</p>

<pre lang="cron"><code>    */20 * * * bin/scanner.rb changeset --org Prod
    */20 * * * bin/scanner.rb changeset --org Hotfix
    */20 * * * bin/scanner.rb changeset --org Sandbox1
</code></pre>

<p>Note that this is the reverse of the common solution. Rather than committing your changes to the VCS and then deploying them to the org, simply go about your development as you normally do and allow the tools to manage the VCS integration. This has the benefit of allowing the tool to track declarative and configuration changes.</p>

<p>Now consider that for the past week your developers have been working in Sandbox1 on a new feature while the changes have all been tracked by SfOpticon. It's time to deploy.</p>

<h3>
<a name="deployment" class="anchor" href="#deployment"><span class="octicon octicon-link"></span></a>Deployment</h3>

<p>Now imagine that a SEV1 issue has just come in and you need to get this deployed to production right away. Hack away on the hotfix environment until you're ready for deploy.</p>

<p>Execute:</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/integrate.rb merge --source Hotfix --destination Production
</pre></div>

<p>This command will create a temporary integration branch from the Production branch, merge in the changes to Hotfix, generate destructive and productive manifests from the branch diffs, and deploy your changes to production.</p>

<p>Pretty cool, yeah?</p>

<p>But wait. Now Sandbox1 is out of sync with production. What's more, maybe the SEV1 you just pushed has overlapping code with your feature on the sandbox.</p>

<p>It's time to rebase!</p>

<h3>
<a name="rebasing" class="anchor" href="#rebasing"><span class="octicon octicon-link"></span></a>Rebasing</h3>

<p>Rebasing will take any changes in the production environment and merge them into the sub-environment using the VCS merging tools. </p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/integrate.rb rebase --org Sandbox1
</pre></div>

<p>Voila! Your production changes are merged to your sandbox and overlapping code has been handled by the VCS.</p>

<p>Alternatively you could've executed the merge using the hotfix and sandbox names for the merge arguments. This is useful to move code around for integration testing, UAT, etc.</p>

<div class="highlight highlight-console"><pre><span class="gp">$</span> ./bin/integrate.rb merge --source Hotfix --destination Sandbox1
</pre></div>

<p>If there are merge conflicts you'll be notified and the script will exit. </p>

<h3>
<a name="cherry-picking" class="anchor" href="#cherry-picking"><span class="octicon octicon-link"></span></a>Cherry Picking</h3>

<p>Say you would like to choose which changes on Sandbox1 you'd like to deploy to Production. We understand. We want that feature too, and it's on the roadmap. However it doesn't exist today. Today you'll need to actually undo those changes in the source environment and allow the scanner to apply the changeset to the VCS prior to deployment.</p>

<h3>
<a name="troubleshooting" class="anchor" href="#troubleshooting"><span class="octicon octicon-link"></span></a>Troubleshooting</h3>

<p>If you receive errors during the instillation, please ensure you have satisfied the following, OS specific, dependencies:</p>

<h5>
<a name="red-hat" class="anchor" href="#red-hat"><span class="octicon octicon-link"></span></a>Red Hat</h5>

<ul>
<li>mysql-devel</li>
</ul><h5>
<a name="ubuntu-debian" class="anchor" href="#ubuntu-debian"><span class="octicon octicon-link"></span></a>Ubuntu (Debian)</h5>

<ul>
<li>libmysqlclient-dev</li>
<li>mysql-server</li>
</ul><h3>
<a name="authors-and-contributors" class="anchor" href="#authors-and-contributors"><span class="octicon octicon-link"></span></a>Authors and Contributors</h3>

<ul>
<li>Ryan Parr - <a href="https://github.com/ryanparr" class="user-mention">@ryanparr</a> </li>
<li>Josh Arenson - <a href="https://github.com/josharenson" class="user-mention">@josharenson</a>
</li>
<li>Matthew Roark - <a href="https://github.com/matthew-roark" class="user-mention">@matthew-roark</a>
</li>
<li>Deb Weller - <a href="https://github.com/debdub" class="user-mention">@debdub</a>
</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SfOpticon maintained by <a href="https://github.com/sfopticon">sfopticon</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-45689750-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
